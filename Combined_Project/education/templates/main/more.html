{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</title>
    <link rel="stylesheet" href="{% static 'main/css/1285.css' %}">
    <style>
        .rating {
            display: inline-block;
            color: #f39c12; /* –¶–≤–µ—Ç –∑–≤–µ–∑–¥ */
            font-size: 20px;
        }

        .rating .inactive {
            color: #bdc3c7; /* –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–≤–µ–∑–¥—ã */
        }

    </style>
</head>
<body>
<section class="course-details">
    <div class="details-header">
        <a href="{% url 'kyrs' %}" class="back-btn">‚Üê –ù–∞–∑–∞–¥</a>
        <h1>–ü–æ–¥—Ä–æ–±–Ω–µ–µ</h1>
        <div class="header-actions">
            <div class="rating-container">
                <span class="rating-label">–†–µ–π—Ç–∏–Ω–≥:</span>
                <span class="rating-value">{{ average_rating }}</span>
            </div>

            <a href="{% url 'start_course' courses.slug %}" class="buy-btn">
                {% if user.is_authenticated %}
                    –ü—Ä–æ–π—Ç–∏ –∫—É—Ä—Å
                {% else %}
                    –í–æ–π—Ç–∏, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏ –∫—É—Ä—Å
                {% endif %}
            </a>
        </div>
    </div>

    <div class="details-row">
        <!-- –õ–µ–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —Å –±–µ–ª—ã–º –±–ª–æ–∫–æ–º -->
        <div class="details-left">
            <div class="info-block">
                <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                <h1>{{ courses.title }}</h1>
                <p>
                    {{ courses.detailed_description }}
                </p>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ -->
        <div class="details-right">
            <img src="{{ courses.image.url }}" style="margin-left: 115px" alt="Python Logo">
            <div class="meta">
                <div class="meta-item">
                    <h3>{{ courses.duration }} –º–µ—Å—è—Ü</h3>
                    <p>–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è</p>
                </div>
                <div class="meta-item">
                    <h3>{{ courses.topics_count }} —Ç–µ–º</h3>
                    <p>–¢–µ–º–∞ –æ–±—É—á–µ–Ω–∏—è</p>
                </div>
                <div class="meta-item">
                    <h3>{{ courses.completed_users.count }}</h3>
                    <p>–°—Ç—É–¥–µ–Ω—Ç—ã –ø—Ä–æ—à–ª–∏</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="course-statistics">
    <div class="statistics">
        <div class="stat-item">
            <img src="{% static 'main/img/salary.png' %}" alt="–ó–∞—Ä–ø–ª–∞—Ç–∞">
            <h3>{{ courses.yearly_salary }} $ –≤ –≥–æ–¥</h3>
            <p>–ó–∞—Ä–ø–ª–∞—Ç–∞</p>
        </div>
        <div class="line"></div>
        <div class="stat-item">
            <img src="{% static 'main/img/need.png' %}" alt="–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å">
            <h3>{{ courses.demand_percentage }}% –≤ 2024</h3>
            <p>–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å</p>
        </div>
        <div class="line"></div>
        <div class="stat-item">
            <img src="{% static 'main/img/work.png' %}" alt="–ó–∞–Ω—è—Ç–∏–µ">
            <h3>–ë–æ–ª—å—à–µ {{ courses.jobs_available }} —Ä–∞–±–æ—Ç—ã</h3>
            <p>–ó–∞–Ω—è—Ç–∏–µ</p>
        </div>
    </div>
</section>
<div class="bottom-line"></div>
<section class="course-instructors">
    <h2>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é:</h2>
    <div class="instructor-list">
        {% for instructor in instructors %}
            <div class="instructor">
                <img src="{{ instructor.image.url }}" alt="–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å" style="height: 110px; width:105px">
                <h3>{{ instructor.name }}</h3>
                <p>–û–ø—ã—Ç: {{ instructor.experience }}</p>
            </div>
        {% endfor %}
    </div>
</section>
<hr class="line-2">
<h2 style="text-align: center; margin-top: 30px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–±—É—á–∞—é—â–∏—Ö—Å—è</h2>
<section class="comments-section">
    <h2>–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h2>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
    {% if request.user.is_authenticated %}
        <form method="post" class="comment-form">
            {% csrf_token %}
            {{ form.text }}

            <!-- –í—ã–≤–æ–¥ –æ—à–∏–±–æ–∫ -->
            {% if form.errors %}
                <div class="form-errors">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <p style="color: red;">{{ error }}</p>
                        {% endfor %}
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit" class="submit-btn">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
        </form>


    {% else %}
        <p class="login-prompt">
            <a href="{% url 'login' %}" class="login-link">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.
        </p>
    {% endif %}


    <div class="comments-list" id="comments-list">
        {% for comment in page_comment %}
            <div class="comment" id="comment-{{ comment.id }}">
                <!-- –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                <div class="comment-avatar">
                    <img src="{% static 'main/img/'|add:comment.avatar %}" alt="Default Avatar">
                </div>

                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
                <div class="comment-content">
                    <div class="comment-header">
                        <h3 class="comment-user">
                            {{ comment.user.username }}
                            {% if comment.user == request.user %}
                                <span class="user-label"> |–í—ã</span>
                            {% endif %}
                        </h3>
                        <small class="comment-date" style="
                                position: absolute;
                                margin-left: 1000px;">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                        {#                            <small class="comment-edited"  id="edited-{{ comment.id }}" {% if comment.updated_at > comment.created_at %}#}
                        {#                                   style="display: inline;#}
                        {#                                    position: absolute;#}
                        {#                                    margin-left: 933px;#}
                        {#                                    margin-top: 55px;"#}
                        {#                                    {% else %} style="display: none; position: absolute;#}
                        {#                                            margin-left: 933px;#}
                        {#                                            margin-top: 55px;" {% endif %}>#}
                        {#                                        –ò–∑–º–µ–Ω–µ–Ω–æ {{ comment.updated_at|date:"d.m.Y H:i" }}#}
                        {#                            </small>#}
                        <small class="comment-edited" id="edited-{{ comment.id }}"
                                {% if comment.is_edited %}
                               style="display: inline; position: absolute; margin-left: 933px; margin-top: 55px;"
                                {% else %}
                               style="display: none; position: absolute; margin-left: 933px; margin-top: 55px;"
                                {% endif %}
                        >
                            –ò–∑–º–µ–Ω–µ–Ω–æ {{ comment.updated_at|date:"d.m.Y H:i" }}
                        </small>


                    </div>

                    <p class="comment-text" id="text-{{ comment.id }}">{{ comment.text|escape }}</p>
                    <textarea class="edit-textarea" id="edit-text-{{ comment.id }}" style="display: none;"></textarea>

                    <!-- –î–µ–π—Å—Ç–≤–∏—è: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/–£–¥–∞–ª–∏—Ç—å/–°–æ—Ö—Ä–∞–Ω–∏—Ç—å/–û—Ç–º–µ–Ω–∏—Ç—å -->
                    <div class="comment-actions" id="actions-{{ comment.id }}">
                        {% if comment.user == request.user %}
                            <button class="edit-btn" id="edit-btn-{{ comment.id }}"
                                    onclick="editComment({{ comment.id }})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="save-btn" id="save-btn-{{ comment.id }}" style="display: none;"
                                    onclick="saveComment({{ comment.id }})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button class="cancel-btn" id="cancel-btn-{{ comment.id }}" style="display: none;"
                                    onclick="cancelEdit({{ comment.id }}, '{{ comment.text|escapejs }}')">–û—Ç–º–µ–Ω–∏—Ç—å
                            </button>
                            <form method="post" action="{% url 'delete_comment' comment.id %}" class="delete-form"
                                  onsubmit="confirmDelete(event)"
                                  style="position: absolute; margin-left: 1052px; display: inline-block">
                                {% load dict_filters %}


                                {% csrf_token %}
                            </form>
                            <form method="post" action="{% url 'delete_comment' comment.id %}" class="delete-form"
                                  onsubmit="return confirmDelete(event)">
                                {% csrf_token %}
                                <button type="submit" class="delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        {% endif %}

                        <div style="/* position: relative; */margin-left: 970px;margin-top: -22px;max-width: 115px;display: block;align-content: center;justify-content: space-between;">
                            <!-- –ö–Ω–æ–ø–∫–∞ –ª–∞–π–∫–∞ -->
                            <button type="button" style="display: inline"
                                    class="like-btn {% if user_reactions|dict_key:comment.id == 'like' %}active{% endif %}"
                                    onclick="toggleReaction({{ comment.id }}, 'like')">
                                üëç <span id="likes-{{ comment.id }}">{{ comment.like_count }}</span>
                            </button>
                            <!-- –ö–Ω–æ–ø–∫–∞ –¥–∏–∑–ª–∞–π–∫–∞ -->
                            <button type="button" style="margin-left:10px;display: inline"
                                    class="dislike-btn {% if user_reactions|dict_key:comment.id == 'dislike' %}active{% endif %}"
                                    onclick="toggleReaction({{ comment.id }}, 'dislike')">
                                üëé <span id="dislikes-{{ comment.id }}">{{ comment.dislike_count }}</span>
                            </button>
                        </div>


                        <!-- –û—Ç–≤–µ—Ç—ã -->
                        <div class="comment-actions" id="actions-{{ comment.id }}">
                            <!-- –ö–Ω–æ–ø–∫–∞ –û—Ç–≤–µ—Ç–∏—Ç—å -->
                            <button type="button" class="reply-btn" id="reply-btn-{{ comment.id }}"
                                    onclick="toggleReplyForm({{ comment.id }})" style="
                                    {#position: absolute;#}
                                    {#margin-left: 250px;#}
                                    {#margin-top: -29px;#}
                                    ">
                                –û—Ç–≤–µ—Ç–∏—Ç—å
                            </button>

                            <!-- –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ -->
                            <form method="post" class="reply-form" id="reply-form-{{ comment.id }}"
                                  style="display: none;">
                                {% csrf_token %}
                                <textarea name="text" rows="2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." required="" style="
                                        margin-left: -41px;
                                        margin-top: -6px;
                                    "></textarea>
                                <input type="hidden" name="parent_id" value="{{ comment.id }}">
                                <button type="submit" class="submit-reply-btn" style="
                                        display: block;
                                        margin-top: 10px;
                                        margin-bottom: 20px;
                                        margin-left: -40px;
                                    ">–û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                </button>
                            </form>
                            <button type="submit" class="cancel-btn" id="cancel-btn-{{ comment.id }}"
                                    onclick="cancelReply({{ comment.id }})" style="display: none">
                                –û—Ç–º–µ–Ω–∏—Ç—å
                            </button>


                            {% if comment.replies.count == 0 %}
                            {% else %}
                                <div class="comment-1" id="comment-{{ comment.id }}" style="
                                        display: flow;
                                        margin-left: -15px;
                                    ">
                                    <!-- –ö–Ω–æ–ø–∫–∞ –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã -->
                                    {% if comment.replies.all %}
                                        <button type="button" class="toggle-replies-btn"
                                                onclick="toggleReplies({{ comment.id }})"
                                                style="position:relative; margin-top: -18px; margin-left: 15px">
                                            –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã ({{ comment.replies.count }})
                                        </button>
                                    {% endif %}

                                    <!-- –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                                    <!-- –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -->
                                    <div class="replies-container" id="replies-{{ comment.id }}" style="display: none;
                                        border-bottom-left-radius: 15px;border-bottom-right-radius: 15px;border-top-right-radius: 15px;">
                                        {% for reply in comment.replies.all %}
                                            <div class="reply" style="margin-left: 20px; border-radius: 12px;
                                                    border: 2px solid #fb3f3f; padding-top: 8px; padding-left: 15px; max-width: 411px; display: inline-block; width: 100%;">
                                                <strong>{{ reply.user.username }}</strong>
                                                {% if request.user.is_authenticated and reply.user.id == request.user.id %}
                                                    <span class="user-label" style="display: inline-block">|–í—ã</span>
                                                {% else %}
                                                    <span class="user-label"
                                                          style="display: inline-block; font-style: italic">–°—Ç—É–¥–µ–Ω—Ç</span>
                                                {% endif %}
                                                <br>
                                                <small style="font-size: 14px; font: small-caption;">{{ reply.created_at|date:"d.m.Y H:i" }}</small>
                                                <p id="reply-text-{{ reply.id }}"
                                                   style="color: dimgrey; font-size: 14px;">{{ reply.text }}</p>

                                                {% if reply.user.id == request.user.id %}
                                                    <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ -->
                                                    <div style="display: inline-block">
                                                        <button type="button" class="edit-reply-btn"
                                                                id="edit-reply-btn-{{ reply.id }}"
                                                                onclick="toggleEditReplyForm({{ reply.id }})"
                                                                title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" style="
                                                                background-color: chartreuse;
                                                                border: none;
                                                                border-radius: 7px;
                                                                cursor: pointer;
                                                                padding-left: 6px;
                                                                padding: 4px;
                                                                transition: 0.3s ease, transform 0.3s ease;">
                                                            ‚úèÔ∏è
                                                        </button>
                                                        <form action="{% url 'delete_reply' reply.id %}"
                                                              class="delete-form" onsubmit="return confirmDelete(event)"
                                                              style="display: inline;">
                                                            {% csrf_token %}
                                                            <button type="submit" class="delete-btn-1" title="–£–¥–∞–ª–∏—Ç—å">
                                                                üóëÔ∏è
                                                            </button>
                                                        </form>
                                                    </div>

                                                    <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ -->
                                                    <form method="post" id="edit-reply-form-{{ reply.id }}"
                                                          style="display: none; margin-top: 10px;">
                                                        {% csrf_token %}
                                                        <textarea name="text" id="edit-reply-textarea-{{ reply.id }}"
                                                                  rows="2" required
                                                                  style="
                                                                width: 90%;
                                                                border: 2px solid blue;
                                                                border-radius: 5px;
                                                                padding: 10px;
                                                                font-size: 14px;
                                                                resize: none;

                                                            ">{{ reply.text }}</textarea>
                                                        <div>
                                                            <button type="button" onclick="saveReply({{ reply.id }})"
                                                                    class="save-reply-btn" style="margin-right:
                                                            5px;background-color: greenyellow;border: none;border-radius: 5px;padding: 4px; cursor: pointer">
                                                                ‚úÖ
                                                            </button>
                                                            <button type="button"
                                                                    onclick="cancelEditReply({{ reply.id }})"
                                                                    class="cancel-edit-reply-btn"
                                                                    style="
                                                                border: none;
                                                                border-radius: 4px;
                                                                padding: 4px;
                                                                cursor: pointer;
                                                                background-color: crimson;
                                                            ">üôÖüèª
                                                            </button>
                                                        </div>
                                                    </form>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            </div>








        {% empty %}
            <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endfor %}

    <div class="pagination">
        {% if page_comment.has_previous %}
            <a href="?page={{ page_comment.previous_page_number }}" class="pagination-btn">–ù–∞–∑–∞–¥</a>
        {% endif %}

        <span class="current-page">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_comment.number }} –∏–∑ {{ page_comment.paginator.num_pages }}</span>

        {% if page_comment.has_next %}
            <a href="?page={{ page_comment.next_page_number }}" class="pagination-btn">–í–ø–µ—Ä–µ–¥</a>
        {% endif %}
    </div>
    {#{% for comment in page_comment %}#}
    {#    <div>#}
    {#            <!-- –ö–Ω–æ–ø–∫–∞ –ª–∞–π–∫–∞ -->#}
    {#            <button type="button"#}
    {#                    class="like-btn {% if user_reactions|dict_key:comment.id == 'like' %}active{% endif %}"#}
    {#                    onclick="toggleReaction({{ comment.id }}, 'like')">#}
    {#                üëç <span id="likes-{{ comment.id }}">{{ comment.like_count }}</span>#}
    {#            </button>#}
    {#            <!-- –ö–Ω–æ–ø–∫–∞ –¥–∏–∑–ª–∞–π–∫–∞ -->#}
    {#            <button type="button"#}
    {#                    class="dislike-btn {% if user_reactions|dict_key:comment.id == 'dislike' %}active{% endif %}"#}
    {#                    onclick="toggleReaction({{ comment.id }}, 'dislike')">#}
    {#                üëé <span id="dislikes-{{ comment.id }}">{{ comment.dislike_count }}</span>#}
    {#            </button>#}
    {#    </div>#}
    {#{% endfor %}#}
</section>


<script>
    function toggleEditReplyForm(replyId) {
        const editReplyBtn = document.getElementById(`edit-reply-btn-${replyId}`);
        const editReplyForm = document.getElementById(`edit-reply-form-${replyId}`);
        const replyText = document.getElementById(`reply-text-${replyId}`);
        const deleteButton = document.getElementById(`delete-btn-1-${replyId}`);

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏
        if (editReplyForm.style.display === "none") {
            editReplyForm.style.display = "block";
            replyText.style.display = "none";
            editReplyBtn.style.display = "none";
            deleteButton.style.display = "none";
        } else {
            editReplyForm.style.display = "none";
            replyText.style.display = "block";
            editReplyBtn.style.display = "inline-block";
        }
    }

    function saveReply(replyId) {
        const editReplyTextarea = document.getElementById(`edit-reply-textarea-${replyId}`);
        const newText = editReplyTextarea.value.trim();

        if (!newText) {
            alert("–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
            return;
        }

        fetch(`/edit-reply/${replyId}/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRFToken(),
            },
            body: JSON.stringify({text: newText}),
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞.");
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    const replyTextElement = document.getElementById(`reply-text-${replyId}`);
                    replyTextElement.textContent = data.text;

                    const editReplyForm = document.getElementById(`edit-reply-form-${replyId}`);
                    editReplyForm.style.display = "none";
                    replyTextElement.style.display = "block";

                    const editReplyBtn = document.getElementById(`edit-reply-btn-${replyId}`);
                    editReplyBtn.style.display = "inline-block";
                } else {
                    alert(data.message || "–û—Ç–≤–µ—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è.");
                }
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞:", error.message);
                alert(error.message);
            });
    }


    function cancelEditReply(replyId) {
        toggleEditReplyForm(replyId); // –ü—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    }

</script>


<div class="comments-list">
    <script>function toggleEditForm(replyId) {
        const commentTextElement = document.getElementById(`text-${replyId}`);
        const editTextarea = document.getElementById(`edit-reply-btn-${replyId}`);
        const editButton = document.getElementById(`edit-btn-${replyId}`);
        const saveButton = document.getElementById(`save-btn-${replyId}`);
        const cancelButton = document.getElementById(`cancel-btn-${replyId}`);
        const deleteButton = document.getElementById(`delete-btn-${replyId}`);

        editTextarea.value = commentTextElement.textContent.trim();
        editTextarea.style.display = "block";
        commentTextElement.style.display = "none";

        editButton.style.display = "none";
        saveButton.style.display = "inline-block";
        cancelButton.style.display = "inline-block";
        deleteButton.style.display = "none";
    }
    </script>
    <script>
        function toggleReplyForm(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            const replyButton = document.getElementById(`reply-btn-${commentId}`);
            const cancelButton = document.getElementById(`cancel-btn-${commentId}`);

            if (replyForm.style.display === "none") {
                replyForm.style.display = "block";
                if (replyButton) replyButton.style.display = "none";
            } else {
                replyForm.style.display = "none";
                if (replyButton) replyButton.style.display = "inline-block";
                cancelButton.style.display = "inline";
            }
        }

        function toggleReplies(commentId) {
            const repliesContainer = document.getElementById(`replies-${commentId}`);
            const toggleButton = document.querySelector(`[onclick="toggleReplies(${commentId})"]`);


            if (repliesContainer.style.display === "none") {
                repliesContainer.style.display = "block";
                toggleButton.textContent = "–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã";

            } else {
                repliesContainer.style.display = "none";
                toggleButton.textContent = "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã (" + repliesContainer.children.length + ")";
            }
        }
    </script>

    {#<div class="loader" id="loader-{{ comment.id }}"></div>#}
    <script>
        function editComment(commentId) {
            const commentTextElement = document.getElementById(`text-${commentId}`);
            const editTextarea = document.getElementById(`edit-text-${commentId}`);
            const editButton = document.getElementById(`edit-btn-${commentId}`);
            const saveButton = document.getElementById(`save-btn-${commentId}`);
            const cancelButton = document.getElementById(`cancel-btn-${commentId}`);
            const deleteButton = document.getElementById(`delete-btn-${commentId}`);

            editTextarea.value = commentTextElement.textContent.trim();
            editTextarea.style.display = "block";
            commentTextElement.style.display = "none";

            editButton.style.display = "none";
            saveButton.style.display = "inline-block";
            cancelButton.style.display = "inline-block";
            deleteButton.style.display = "none";
        }

        function saveComment(commentId) {
            const editTextarea = document.getElementById(`edit-text-${commentId}`);
            const newText = editTextarea.value.trim();

            if (!newText) {
                alert("–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
                return;
            }

            fetch(`/edit-comment/${commentId}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({text: newText}),
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è.");
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        const commentTextElement = document.getElementById(`text-${commentId}`);
                        const editTextarea = document.getElementById(`edit-text-${commentId}`);
                        const saveButton = document.getElementById(`save-btn-${commentId}`);
                        const cancelButton = document.getElementById(`cancel-btn-${commentId}`);
                        const editButton = document.getElementById(`edit-btn-${commentId}`);

                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                        commentTextElement.textContent = data.text;

                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                        commentTextElement.style.display = "block";
                        editTextarea.style.display = "none";
                        saveButton.style.display = "none";
                        cancelButton.style.display = "none";
                        editButton.style.display = "inline-block";

                        // –û–±–Ω–æ–≤–ª—è–µ–º "–∏–∑–º–µ–Ω–µ–Ω–æ"
                        const editedLabel = document.getElementById(`edited-${commentId}`);
                        if (editedLabel) {
                            editedLabel.textContent = `–ò–∑–º–µ–Ω–µ–Ω–æ ${data.updated_at}`;
                            editedLabel.style.display = "inline";
                        }
                    } else {
                        alert(data.message || "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è.");
                    }
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞:", error.message);
                    alert(error.message);
                });
        }


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF-—Ç–æ–∫–µ–Ω–∞
        function getCSRFToken() {
            const cookieValue = document.cookie
                .split("; ")
                .find(row => row.startsWith("csrftoken="))
                ?.split("=")[1];
            return cookieValue || "";
        }


        function cancelEdit(commentId, originalText) {
            const commentTextElement = document.getElementById(`text-${commentId}`);
            const editTextarea = document.getElementById(`edit-text-${commentId}`);
            const editButton = document.getElementById(`edit-btn-${commentId}`);
            const saveButton = document.getElementById(`save-btn-${commentId}`);
            const cancelButton = document.getElementById(`cancel-btn-${commentId}`);

            editTextarea.style.display = "none";
            commentTextElement.style.display = "block";
            editTextarea.value = originalText;

            saveButton.style.display = "none";
            cancelButton.style.display = "none";
            editButton.style.display = "inline-block";
        }

        function confirmDelete(event) {
            const deleteReply = document.getElementById(`delete-btn-1-${commentId}`)
            deleteReply.style.display = "none"
            if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?")) {
                event.preventDefault();
            }
        }
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const maxWords = 30;  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤
            const textarea = document.querySelector('textarea[name="text"]');
            const wordCountMessage = document.getElementById('wordCountMessage');
            const currentWords = document.getElementById('currentWords');
            const submitButton = document.querySelector('.submit-btn');

            textarea.addEventListener('input', () => {
                // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ
                const wordCount = textarea.value.trim().split(/\s+/).filter(word => word).length;

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤
                currentWords.textContent = wordCount;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
                if (wordCount > maxWords) {
                    wordCountMessage.style.display = 'block';
                    submitButton.disabled = true;  // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                } else {
                    wordCountMessage.style.display = 'none';
                    submitButton.disabled = false;  // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                }
            });
        });
    </script>
    <script>
        function toggleReaction(commentId, reactionType) {
            const url = reactionType === 'like' ? `/like-comment/${commentId}/` : `/dislike-comment/${commentId}/`;

            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤ –∏ –¥–∏–∑–ª–∞–π–∫–æ–≤
                        document.getElementById(`likes-${commentId}`).textContent = data.like_count;
                        document.getElementById(`dislikes-${commentId}`).textContent = data.dislike_count;

                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –∫–Ω–æ–ø–æ–∫
                        const likeBtn = document.querySelector(`#comment-${commentId} .like-btn`);
                        const dislikeBtn = document.querySelector(`#comment-${commentId} .dislike-btn`);

                        if (reactionType === 'like') {
                            likeBtn.classList.toggle('active', data.user_reacted === 'like');
                            dislikeBtn.classList.remove('active');
                        } else {
                            dislikeBtn.classList.toggle('active', data.user_reacted === 'dislike');
                            likeBtn.classList.remove('active');
                        }
                    } else {
                        alert(data.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ–∞–∫—Ü–∏–∏.");
                    }
                })
                .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
        }


    </script>
    <div class="bottom-line"></div>
</body>
</html>